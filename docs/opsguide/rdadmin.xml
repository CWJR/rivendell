<chapter xmlns="http://docbook.org/ns/docbook" xml:id="chapter.rdadmin">
  <title>Configuring Rivendell with RDAdmin</title>
  <sect1 xml:id="sect.rdadmin.overview">
    <title>Overview</title>
    <para>
      RDAdmin is the Rivendell module designed for the comprehensive
      configuration of the Rivendell system.
    </para>
    <para>
      <mediaobject>
	<imageobject>
	  <imagedata align="center" fileref="rdadmin.rdadmin_screenshot.png" scale="45"/>
	</imageobject>
	<caption>
	  <para>The RDAdmin Main Window</para>
	</caption>
      </mediaobject>
    </para>
    <para>
      When starting up RDAdmin, you will be prompted to login in. For a
      freshly created Rivendell database, the default login parameters are
      a <computeroutput>User Name:</computeroutput> of
      <userinput>admin</userinput> with no
      <computeroutput>Password:</computeroutput>.
    </para>
    <para>
      <mediaobject>
	<imageobject>
	  <imagedata align="center" fileref="rdadmin.login_dialog.png" scale="45"/>
	</imageobject>
	<caption>
	  <para>The Login Dialog</para>
	</caption>
      </mediaobject>
    </para>
  </sect1>
  <sect1 xml:id="sect.rdadmin.managing_users">
    <title>Managing Users</title>
    <para>
      To manage users in RDAdmin, touch the
      <computeroutput>Manage Users</computeroutput> to open the
      Rivendell User List dialog.
    </para>
    <para>
      <mediaobject>
	<imageobject>
	  <imagedata align="center" fileref="rdadmin.rivendell_user_list_dialog.png" scale="45"/>
	</imageobject>
	<caption>
	  <para>The Rivendell User List Dialog</para>
	</caption>
      </mediaobject>
    </para>
    <para>
      Two different types of user exist within Rivendell: 
      <emphasis>administrator</emphasis> users (those which have the
      <computeroutput>Administer System</computeroutput> right set), who
      are allowed to log into RDAdmin, and
      <emphasis>operational</emphasis> users, who are configured to have
      rights to operate specific portions of the Rivendell system but do
      not have access to RDAdmin. It is not possible for a single user to
      act in both roles.
    </para>
    <para>
      A newly created Rivendell database will have one user of each type
      populated automatically, called &quot;admin&quot; and
      &quot;user&quot; respectively. To see the attributes of an existing
      user, select its entry on the <computeroutput>Users</computeroutput>
      list and touch the <computeroutput>Edit</computeroutput> button to
      open the User Dialog.
    </para>
    <para>
      <mediaobject>
	<imageobject>
	  <imagedata align="center" fileref="rdadmin.user_dialog.png" scale="45"/>
	</imageobject>
	<caption>
	  <para>The Rivendell User Dialog</para>
	</caption>
      </mediaobject>
    </para>
    <para>
      The upper third of the the dialog provides fields for basic information
      regarding the user as well as authentication settings. If the
      <computeroutput>Authenticate This User Locally</computeroutput> box
      is ticked, then the login password for this user can be set by touching
      the <computeroutput>Change Password</computeroutput> button. If
      unticked, then authentication is delegated to the Pluggable
      Authentication Module (PAM) specified in the
      <computeroutput>PAM Service:</computeroutput> field.
    </para>
    <para>
      The <computeroutput>WebAPI Timeout:</computeroutput> field sets the
      timeout (in seconds) when connecting to Rivendell's WebAPI
      component, while the <computeroutput>Allow Web Logins</computeroutput>
      box, if ticked, permits this user to use the web component of
      RDCastManager.
    </para>
    <para>
      The middle section of the dialog is where individual user rights
      are assigned for this user. The
      <computeroutput>Administer System</computeroutput> box, if ticked,
      will make this user an administrative user while disallowing the
      selection of any other rights. The other listed rights should be
      self-explanatory.
    </para>
    <para>
      The bottom of the dialog contains three large buttons. The
      <computeroutput>Assign Group Permissions</computeroutput> button
      allows assignment of the specific groups which this user will be
      allowed to access in RDLibrary, 
      the <computeroutput>Service Permissions</computeroutput> allows
      assignment of the services which this user will be allowed to
      access in RDLogEdit and the
      <computeroutput>Assign Podcast Feed Permissions</computeroutput>
      allows the assignment of the podcast feeds which this user will
      be allowed to manage in RDCastManager.
    </para>
    <para>
      Touch the <computeroutput>OK</computeroutput> button to commit any
      changes made, or <computeroutput>Cancel</computeroutput> to
      abandon them.
    </para>
  </sect1>
  <sect1 xml:id="sect.rdadmin.manage_groups">
    <title>Managing Groups</title>
    <para>
      To manage groups in RDAdmin, touch the
      <computeroutput>Manage Groups</computeroutput> button to open
      the Rivendell Group List dialog.
    </para>
    <para>
      <mediaobject>
	<imageobject>
	  <imagedata align="center" fileref="rdadmin.rivendell_group_list_dialog.png" scale="45"/>
	</imageobject>
	<caption>
	  <para>The Rivendell Group List Dialog</para>
	</caption>
      </mediaobject>
    </para>
    <sect2 xml:id="sect.rdadmin.manage_groups.editing_group_information">
      <title>Editing Group Information</title>
      <para>
	To examine and modify an existing group, touch its entry in the
	<computeroutput>Groups</computeroutput> list and then touch the
	<computeroutput>Edit</computeroutput> button to open the
	Group Dialog.
      </para>
      <para>
	<mediaobject>
	  <imageobject>
	    <imagedata align="center" fileref="rdadmin.group_dialog.png" scale="45"/>
	  </imageobject>
	  <caption>
	    <para>The Rivendell Group Dialog</para>
	  </caption>
	</mediaobject>
      </para>
      <para>
	The <computeroutput>Default Import Title</computeroutput> is the
	title string that will be assigned to carts created by dropboxes or
	<command>rdimport</command><manvolnum>1</manvolnum> when no 
	file-specific title metadata is found. This field recognizes
	the following wildcards:
      </para>
      <table xml:id="table.rdadmin.default_import_title_wildcards" frame="all" pgwide="0">
	<title>Default Import Title Wildcards</title>
	<tgroup cols="2" align="left" colsep="1" rowsep="1">
	  <colspec colname="Wildcard" colwidth="1.0*"/>
	  <colspec colname="Value" colwidth="10.0*"/>
	  <tbody>
	    <row><entry>%f</entry><entry>Body part of the filename</entry></row>
	    <row><entry>%e</entry><entry>Extension part of the filename</entry></row>
	  </tbody>
	</tgroup>
      </table>
      <para>
	The <computeroutput>Default Cart Type:</computeroutput> controls
	which type of cart (<computeroutput>Audio</computeroutput> or
	<computeroutput>Macro</computeroutput> RDLibrary will default to
	when creating a new cart in this group.
      </para>
      <para>
	The <computeroutput>Default Cart Number:</computeroutput> fields
	define a range of cart numbers to use by default for this group
	--i.e. by RDLibrary or
	<command>rdimport</command><manvolnum>1</manvolnum>. If the
	<computeroutput>Enforce Cart Range</computeroutput> box is ticked,
	Rivendell will not permit carts to be created in or moved to this
	group whose cart number does not fall within this range.
      </para>
      <para>
	If the 
	<computeroutput>Include this group in Traffic reports</computeroutput> or
	<computeroutput>Include this group in Music reports</computeroutput> box
	is ticked, play-outs of carts belonging to this group in a log will
	be included in traffic or music reports, respectively.
      </para>
      <para>
	If this <computeroutput>Set End Date/Time</computeroutput> box is ticked,
	then new cuts that belong to this group will have their end date/time
	automatically set to the specified number of days after the date of
	creation.
      </para>
      <para>
	If the <computeroutput>Purge expired cuts</computeroutput> box is
	ticked, then cuts in the group will be purged --i.e. deleted --
	the specified number of days after they expire. If
	<computeroutput>Delete cart if empty</computeroutput> is also ticked,
	then the cart containing the deleted cut will also be deleted if it
	contains no other cuts.
      </para>
      <para>
	If the <computeroutput>Transmit Now &apos; Next</computeroutput> box
	is ticked, then carts in this group will generate an RLM event when
	played in a log.
      </para>
      <para>
	Carts in this group will be allowed to play only on those services
	that are shown in the <computeroutput>Active Services</computeroutput>
	list.
      </para>
      <para>
	To set a color for the group (used when the group name is displayed
	elsewhere in Rivendell, touch the <computeroutput>Color</computeroutput>
	button.
      </para>
      <para>
	Touch the <computeroutput>OK</computeroutput> button to commit any
	changes made, or <computeroutput>Cancel</computeroutput> to
	abandon them.
      </para>
    </sect2>
    <sect2 xml:id="rdadmin.manage_groups.renaming_groups">
      <title>Renaming Groups</title>
      <para>
	A group can be renamed by touching the
	<computeroutput>Rename</computeroutput> button. If the
	<computeroutput>New Group Name:</computeroutput> given already exists,
	then the carts in this group will be moved into that group.
      </para>
      <para>
	<mediaobject>
	  <imageobject>
	    <imagedata align="center" fileref="rdadmin.rename_group_dialog.png" scale="60"/>
	  </imageobject>
	  <caption>
	    <para>The Rename Group Dialog</para>
	  </caption>
	</mediaobject>
      </para>
    </sect2>
    <sect2 xml:id="rdadmin.manage_groups.group_reports">
      <title>Group Report</title>
      <para>
	A printable report listing the defined groups and their attributes
	can be generated by touching the
	<computeroutput>Generate Report</computeroutput> button.
      </para>
    </sect2>
  </sect1>
  <sect1 xml:id="sect.rdadmin.manage_services">
    <title>Managing Services</title>
    <para>
      To manage services in RDAdmin, touch the
      <computeroutput>Manage Services</computeroutput> button to open
      the Rivendell Services dialog.
    </para>
    <para>
      <mediaobject>
	<imageobject>
	  <imagedata align="center" fileref="rdadmin.services_dialog.png" scale="45"/>
	</imageobject>
	<caption>
	  <para>The Rivendell Services Dialog</para>
	</caption>
      </mediaobject>
    </para>
    <para>
      To examine and modify an existing service, touch its entry in the
      <computeroutput>Services</computeroutput> list and then touch the
      <computeroutput>Edit</computeroutput> button to open the
      Group Dialog.
    </para>
    <para>
      <mediaobject>
	<imageobject>
	  <imagedata align="center" fileref="rdadmin.edit_service_dialog.png" scale="45"/>
	</imageobject>
	<caption>
	  <para>The Edit Service Dialog</para>
	</caption>
      </mediaobject>
    </para>
    <sect2 xml:id="sect.rdadmin.manage_services.general">
      <title>The <computeroutput>General</computeroutput> Section</title>
      <para>
	The <computeroutput>Service Name</computeroutput> field contains
	the name of the service (read-only). This value is available in
	<link linkend="sect.filepath_wildcards.definition">
	filepath wildcards</link> as <userinput>%s</userinput>.
      </para>
      <para>
	The <computeroutput>Service Description</computeroutput> field is
	for a free-form string that describes the service.
      </para>
      <para>
	The <computeroutput>Program Code</computeroutput> is a string that
	is sent to RLM plug-ins as part of every Now &amp; Next update.
      </para>
      <para>
	The <computeroutput>Log Name Template</computeroutput> field is
	a string that defines how logs will be named when generated by
	RDLogManager. This field can take
	<link linkend="sect.filepath_wildcards.definition">
	filepath wildcards</link>.
      </para>
      <para>
	The <computeroutput>Log Description Template</computeroutput> field
	is a string that defines how the
	<computeroutput>Description</computeroutput> for each log will be
	formatted for logs generated by RDLogManager. This field can take
	<link linkend="sect.filepath_wildcards.definition">
	filepath wildcards</link>.
      </para>
      <para>
	The <computeroutput>Voicetrack Group</computeroutput> dropdown
	specifies the Rivendell group to be used for storing voicetracks
	for this service.
      </para>
      <para>
	<!--
	    FIXME: Document AutoSpot!
	-->
	The <computeroutput>AutoSpot Group</computeroutput> dropdown
	specifies the Rivendell group to be used for storing carts used
	for the AutoSpot functionality.
      </para>
      <para>
	The <computeroutput>Insert CHAIN TO at log end</computeroutput>,
	if ticked, will cause a CHAIN-TO event to the following day's log
	to be appended to the log when generated by RDLogManager.
      </para>
      <para>
	The <computeroutput>Enable AutoRefresh By Default</computeroutput>
	box, if ticked, will cause the log's
	<computeroutput>Enable AutoRefresh</computeroutput> attribute to
	be set to <computeroutput>Yes</computeroutput> when generated
	by RDLogManager.
      </para>
      <para>
	The <computeroutput>Purge Logs after</computeroutput> box,
	if ticked, will set the deletion date for logs to be the
	specified number of days after being created by RDLogManager.
      </para>
      <para>
	The <computeroutput>Purge ELR Data after</computeroutput>
	box, if ticked, will cause Electronic Log Reconiliation (ELR)
	as-played data to be purged from the database the specified number
	of days after being generated.
      </para>
      <sect3 xml:id="sect.rdadmin.manage_services.general.configure_autofill_carts">
	<title>Configuring Autofill Carts</title>
	<para>
	  The <computeroutput>Configure Autofill Carts</computeroutput>
	  button will bring up the Autofill Carts dialog>
	</para>
	<para>
	  <mediaobject>
	    <imageobject>
	      <imagedata align="center" fileref="rdadmin.autofill_carts_dialog.png" scale="45"/>
	    </imageobject>
	    <caption>
	      <para>The Autofill Carts Dialog</para>
	    </caption>
	  </mediaobject>
	</para>
	<para>
	  Carts listed in this dialog will be considered for inclusion
	  in an event by RDLogManager when the event's
	  <computeroutput>Use Autofill</computeroutput> box is ticked.
	  When filling a gap, RDLogManager will recursively scan the list
	  of available carts, working from the longest to to shortest, and
	  insert the longest cart that will fit. The process will stop when
	  either the available gap has been completely filled or no cart
	  short enough to fit has been found.
	</para>
      </sect3>
      <sect3 xml:id="sect.rdadmin.manage_services.general.enabling_hosts_for_service_playout">
	<title>Enabling Hosts for Service Playout</title>
	<para>
	  The <computeroutput>Enable Hosts</computeroutput> button will bring
	  up the Hosts dialog, where the hosts for which this service is
	  allowed to be played can be defined
	</para>
	<para>
	  <mediaobject>
	    <imageobject>
	      <imagedata align="center" fileref="rdadmin.hosts_dialog.png" scale="45"/>
	    </imageobject>
	    <caption>
	      <para>The Hosts Dialog</para>
	    </caption>
	  </mediaobject>
	</para>
      </sect3>
    </sect2>
    <sect2 xml:id="sect.rdadmin.manage_services.traffic_music_data_importation_settings">
      <title>Traffic/Music Data Importation Settings</title>
      <para>
	With the exception of one field
	(<computeroutput>Insert Traffic Break String</computeroutput>),
	the <computeroutput>Traffic Data Import</computeroutput> and
	<computeroutput>Music Data Import</computeroutput> sections are
	identical. Thus, only the
	<computeroutput>Music Data Import</computeroutput> section will be
	described here.
      </para>
      <para>
	The upper part of the section consists of string fields and a dropdown
	box.
      </para>
      <para>
	<mediaobject>
	  <imageobject>
	    <imagedata align="center" fileref="rdadmin.log_importation_string_fields.png" scale="45"/>
	  </imageobject>
	  <caption>
	    <para>Log Importation String Fields</para>
	  </caption>
	</mediaobject>
      </para>
      <para>
	The <computeroutput>Linux Import Path</computeroutput> field takes
	the fully-qualified path to the file to be used for import events
	by RDLogManager when run on Linux. This field can take
	<link linkend="sect.filepath_wildcards.definition">
	filepath wildcards</link>.
      </para>
      <para>
	The <computeroutput>Linux Preimport Command</computeroutput> field
	takes the fully-qualified path to the command to be run before
	attempting to import the file specified in
	<computeroutput>Linux Import Path</computeroutput>. This field can take
	<link linkend="sect.filepath_wildcards.definition">
	filepath wildcards</link>.
      </para>
      <para>
	The <computeroutput>Windows Import Path</computeroutput> field takes
	the fully-qualified path to the file to be used for import events
	by RDLogManager when run on Windows. This field can take
	<link linkend="sect.filepath_wildcards.definition">
	filepath wildcards</link>.
      </para>
      <para>
	The <computeroutput>Windows Preimport Command</computeroutput> field
	takes the fully-qualified path to the command to be run before
	attempting to import the file specified in
	<computeroutput>Windows Import Path</computeroutput>. This field
	can take <link linkend="sect.filepath_wildcards.definition">
	filepath wildcards</link>.
      </para>
      <para>
	The <computeroutput>Note Cart String</computeroutput> field can
	be used	to configure placement of a marker event in the generated log.
	When the string set here is found in the 'cart' field in a line
	of the specified import file, RDLogManager will insert a marker
	event, the text of which will be the 'title' field from that same
	line.
      </para>
      <para>
	The <computeroutput>Insert Voice Track String</computeroutput>
	field can be used to configure placement of a voice track marker
	in the generated log. When the string set here is found in the
	'cart' field in a line of the specified import file, RDLogManager
	will insert a voice track event, the text of which will be the
	'title' field from that same line.
      </para>
      <para>
	The <computeroutput>Insert Traffic Break String</computeroutput>
	field can be used to configuration placement of a traffic break
	from an entry in the music import log. When the string set here is
	found in the cart field. RDLogManager will insert a traffic import
	event, using the event specified in the
	<computeroutput>Import inline traffic</computeroutput> dropdown box
	in the relevant music event.
      </para>
      <note>
	<para>
	  This field is available only in the
	  <computeroutput>Music Data Import</computeroutput> section!
	</para>
      </note>
    </sect2>
  </sect1>
</chapter>
